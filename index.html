<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Who tweeted this?</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="Check who tweeted the url you submit in your twitter timeline">
		<meta name="author" content="Aurelien Tabard">

		<!-- Le styles -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<style>
			body {
				padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
			}
		</style>
		<link href="css/bootstrap-responsive.css" rel="stylesheet">

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
		 <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<!-- Le fav and touch icons -->
		<link rel="shortcut icon" href="images/favicon.ico">

		<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
		<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	</head>

	<body>
		<div class="container">
			<h1>Who tweeted this?</h1>

			{% if logged %}
				<p>
					<strong>Screen Name: {{ info['screen_name'] }} </strong><br />
					<strong>Location: {{ info['location'] }} </strong><br />
	          
					<a href="/oauth/twitter/logout">Logout from Twitter</a><br /><br />
				</p>
			{% else %}
				<a href="/oauth/twitter/login">Login via Twitter</a>
			{% endif %}    

			<form id="form" action="/" method="get">
				<div>
					<input name="url" value="{{ link }}"/> <input type="submit" value="who">
				</div>
		    </form>
		</div> <!-- /container -->

		<!-- Le javascript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="js/jquery-1.7.1.js"></script>
		<script src="js/bootstrap.min.js"></script>
		
		
		<script>
		{% if logged %}
			var twitter_username = "{{info['screen_name']}}";

			{% if link %}
			var found = false;
			var maxPage = 10;
			$(document).ready(function() {
				var page = 1;
				for (page = 1; page < maxPage; page++) {
					checkLink("{{link}}", page);
				}
				// TODO this check inside a timer!
				if (!found) {
					alert("Couldn't find it :( \n Are you sure the link comes from twitter?");
				}
			});
			{% else %}
			{% endif %}   

			function checkLink(link,page){
				$.ajax({
				  type: "GET",
				  url: "link/"+link+"/?page="+page
				}).done(function( msg ) {
					if (msg != "") {
						window.location.href = "https://twitter.com/#!/" + msg;
					} 
					else //Not found on this page
						alert(page);
				})
			}
		{% else %}
		{% endif %}    
		</script>
		<script src="jquery.twitterbird.js"></script>
	</body>
</html>
